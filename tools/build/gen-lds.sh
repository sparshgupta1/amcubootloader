#!/bin/sh
#        ___
#   ___ / _ \
#  / _ ' (_) |       __  _
# | (_) ,___/       / _|(_)
#  \___/  _  _ __  | |_  _  _ __    ___  _ __  __ _
#        | || '_ \ |  _|| || '_ \  / _ \| '__|/ _` |
#        | || | | || |  | || | | ||  __/| |  | (_| |
#        |_||_| |_||_|  |_||_| |_| \___||_|   \__,_|
#
# @file gen-lds.sh.sh            @brief Replace named constants in linker script
#                                       using C preprocessor
#
# @author Sparsh Gupta
#
# @copyright 2023 Infinera. All rights reserved.
# Infinera Proprietary and Confidential.
#
# @details
# $1    - original linker script file
# $2    - Include Directory
# $3    - Output linker script file
# $4    - C Copmpiler executable path

in=$1
inc=$2
out=$3
compiler=$4
shift
shift

logCopyrightInfo() {

  local headerStr="
/**       ___
 *   ___ / _ \\
 *  / _ ' (_) |       __  _
 * | (_) ,___/       / _|(_)
 *  \___/  _  _ __  | |_  _  _ __    ___  _ __  __ _
 *        | || '_ \ |  _|| || '_ \  / _ \| '__|/ _' |
 *        | || | | || |  | || | | ||  __/| |  | (_| |
 *        |_||_| |_||_|  |_||_| |_| \___||_|   \__,_|
 *
 * @file $1            @brief linker script
 *
 * @author Autogenerated
 *
 * @copyright 2023 Infinera. All rights reserved.
 * Infinera Proprietary and Confidential.
 *
 * @details
 * This file was generated automatically, src $2 for details
 * Please do not modify it manually
 *
 ***************************************************************************/
"

  printf '%s' "$headerStr" > $out
}

logCopyrightInfo $(basename -- "$out") $(basename -- "$in")
$compiler -E -x c -I$inc $in | grep -v '^#'         >>$out